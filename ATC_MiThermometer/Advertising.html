<!DOCTYPE html>
<html>
  <head><meta charset="utf-8">
  <title>ATC Temperature and Humidity</title>
  </head>
  <body>
	<div style="height: auto; width: auto; text-align: center;">
	<input type="button" id="butConnect" onclick="onButtonClick();" value="Select an advertising device">
	</div><hr>
	<div id="log"></div>
  </body>
<script type="text/javascript">
// https://googlechrome.github.io/samples/web-bluetooth/watch-advertisements-async-await.html
function log(data) {
    var time = new Date().toLocaleTimeString("de-DE");
    var logString = time + ": " + data;
    document.getElementById("log").innerHTML += logString + "<br>";
}

function onButtonClick() {
  log('Requesting Bluetooth Scan...');
  navigator.bluetooth.requestDevice({
  filters: [
    { name: '' },
    { namePrefix: '0' },
    { namePrefix: '1' },
    { namePrefix: '2' },
    { namePrefix: '3' },
    { namePrefix: '4' },
    { namePrefix: '5' },
    { namePrefix: '6' },
    { namePrefix: '7' },
    { namePrefix: '8' },
    { namePrefix: '9' },
    { namePrefix: 'a' },
    { namePrefix: 'b' },
    { namePrefix: 'c' },
    { namePrefix: 'd' },
    { namePrefix: 'e' },
    { namePrefix: 'f' },
    { namePrefix: 'g' },
    { namePrefix: 'h' },
    { namePrefix: 'i' },
    { namePrefix: 'j' },
    { namePrefix: 'k' },
    { namePrefix: 'l' },
    { namePrefix: 'm' },
    { namePrefix: 'n' },
    { namePrefix: 'o' },
    { namePrefix: 'p' },
    { namePrefix: 'q' },
    { namePrefix: 'r' },
    { namePrefix: 's' },
    { namePrefix: 't' },
    { namePrefix: 'u' },
    { namePrefix: 'v' },
    { namePrefix: 'w' },
    { namePrefix: 'x' },
    { namePrefix: 'y' },
    { namePrefix: 'z' },
    { namePrefix: 'A' },
    { namePrefix: 'B' },
    { namePrefix: 'C' },
    { namePrefix: 'D' },
    { namePrefix: 'E' },
    { namePrefix: 'F' },
    { namePrefix: 'G' },
    { namePrefix: 'H' },
    { namePrefix: 'I' },
    { namePrefix: 'J' },
    { namePrefix: 'K' },
    { namePrefix: 'L' },
    { namePrefix: 'M' },
    { namePrefix: 'N' },
    { namePrefix: 'O' },
    { namePrefix: 'P' },
    { namePrefix: 'Q' },
    { namePrefix: 'R' },
    { namePrefix: 'S' },
    { namePrefix: 'T' },
    { namePrefix: 'U' },
    { namePrefix: 'V' },
    { namePrefix: 'W' },
    { namePrefix: 'X' },
    { namePrefix: 'Y' },
    { namePrefix: 'Z' }
  ], optionalServices: [0xfe95, 0x181a]
	}).then(device => {
    log('> Requested ' + device.name);
    device.addEventListener('advertisementreceived', (event) => {
      log('Device Name: ' + event.device.name + ', RSSI: ' + event.rssi);
      event.serviceData.forEach((valueDataView, key) => {
        logDataView('ServiceData', key, valueDataView);
      });
    });

    log('Watching advertisements from "' + device.name + '"...');
    return device.watchAdvertisements();  
  })
  .catch(error => {
    log('Argh! ' + error);
  });
}

/* Utils */

const logDataView = (labelOfDataSource, key, valueDataView) => {
  let s = '', h = '0123456789ABCDEF';
  (new Uint8Array(valueDataView.buffer)).forEach((v) => { s += h[v >> 4] + h[v & 15]; });
  log(` ${labelOfDataSource} Data: ` + key + ', ' + s);
};
</script>
</html>